pipeline {
    agent any
    stages {
        stage('Set Terraform path') {
            steps {
                script {
                    def tfHome = tool name: 'Terraform'
                    env.PATH = "${tfHome}:${env.PATH}"
                }
                sh 'terraform --version'
            }
        }
        stage('Create Infra') {
            steps {
                withCredentials([file(credentialsId: 'yt_private_key', variable: 'pvt_key'), file(credentialsId: 'yt_public_key', variable: 'pub_key'), string(credentialsId: 'DO_PAT', variable: 'do_token'), string(credentialsId: 'yt_ssh', variable: 'ssh_fingerprint')]) {
			sh """
                    		export TF_LOG="INFO"
                    		terraform init
                    		terraform refresh
				terraform plan
				terraform destroy
			"""
		}
            }
        }
    }
}
